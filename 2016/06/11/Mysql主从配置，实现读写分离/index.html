<!doctype html>
<html class="theme-next use-motion theme-next-mist">
<head>
  

<meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>


<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />






  <link rel="stylesheet" type="text/css" href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5"/>




<link rel="stylesheet" type="text/css" href="/css/main.css?v=0.4.5.1"/>


    <meta name="description" content="ä¹¦ä¸è®°ï¼Œç†Ÿè¯»å¯è®°ï¼›ä¹‰ä¸ç²¾ï¼Œç»†æ€å¯ç²¾ï¼›æƒŸæœ‰å¿—ä¸ç«‹ï¼Œç›´æ˜¯æ— ç€åŠ›å¤„ã€‚â€”â€”æœ±ç†¹" />

<meta name="baidu-site-verification" content="xSJDurVHbh" />

  <meta name="keywords" content="mysql," />



  <link rel="alternate" href="/atom.xml" title="å´å²–çš„è·¯,èµ°å‡ºè‡ªå·±çš„è„šæ­¥" type="application/atom+xml" />




  <link rel="shorticon icon" type="image/x-icon" href="/favicon.ico?v=0.4.5.1" />


<meta name="description" content="åŸæ–‡ï¼šhttp://heylinux.com/archives/1004.html
Mysqlä½œä¸ºç›®å‰ä¸–ç•Œä¸Šä½¿ç”¨æœ€å¹¿æ³›çš„å…è´¹æ•°æ®åº“ï¼Œç›¸ä¿¡æ‰€æœ‰ä»äº‹ç³»ç»Ÿè¿ç»´çš„å·¥ç¨‹å¸ˆéƒ½ä¸€å®šæ¥è§¦è¿‡ã€‚ä½†åœ¨å®é™…çš„ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œç”±å•å°Mysqlä½œä¸ºç‹¬ç«‹çš„æ•°æ®åº“æ˜¯å®Œå…¨ä¸èƒ½æ»¡è¶³å®é™…éœ€æ±‚çš„ï¼Œæ— è®ºæ˜¯åœ¨å®‰å…¨æ€§ï¼Œé«˜å¯ç”¨æ€§ä»¥åŠé«˜å¹¶å‘ç­‰å„ä¸ªæ–¹é¢ã€‚
å› æ­¤ï¼Œä¸€èˆ¬æ¥è¯´éƒ½æ˜¯é€šè¿‡ ä¸»ä»å¤åˆ¶ï¼ˆMaster-Slaveï¼‰çš„æ–¹å¼æ¥åŒæ­¥æ•°æ®ï¼Œå†é€šè¿‡è¯»å†™åˆ†ç¦»ï¼ˆMy">
<meta property="og:type" content="article">
<meta property="og:title" content="Mysqlä¸»ä»é…ç½®ï¼Œå®ç°è¯»å†™åˆ†ç¦»">
<meta property="og:url" content="http://dingran.tk/2016/06/11/Mysqlä¸»ä»é…ç½®ï¼Œå®ç°è¯»å†™åˆ†ç¦»/index.html">
<meta property="og:site_name" content="å´å²–çš„è·¯,èµ°å‡ºè‡ªå·±çš„è„šæ­¥">
<meta property="og:description" content="åŸæ–‡ï¼šhttp://heylinux.com/archives/1004.html
Mysqlä½œä¸ºç›®å‰ä¸–ç•Œä¸Šä½¿ç”¨æœ€å¹¿æ³›çš„å…è´¹æ•°æ®åº“ï¼Œç›¸ä¿¡æ‰€æœ‰ä»äº‹ç³»ç»Ÿè¿ç»´çš„å·¥ç¨‹å¸ˆéƒ½ä¸€å®šæ¥è§¦è¿‡ã€‚ä½†åœ¨å®é™…çš„ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œç”±å•å°Mysqlä½œä¸ºç‹¬ç«‹çš„æ•°æ®åº“æ˜¯å®Œå…¨ä¸èƒ½æ»¡è¶³å®é™…éœ€æ±‚çš„ï¼Œæ— è®ºæ˜¯åœ¨å®‰å…¨æ€§ï¼Œé«˜å¯ç”¨æ€§ä»¥åŠé«˜å¹¶å‘ç­‰å„ä¸ªæ–¹é¢ã€‚
å› æ­¤ï¼Œä¸€èˆ¬æ¥è¯´éƒ½æ˜¯é€šè¿‡ ä¸»ä»å¤åˆ¶ï¼ˆMaster-Slaveï¼‰çš„æ–¹å¼æ¥åŒæ­¥æ•°æ®ï¼Œå†é€šè¿‡è¯»å†™åˆ†ç¦»ï¼ˆMy">
<meta property="og:image" content="http://heylinux.com/wp-content/uploads/2011/06/mysql-master-salve-proxy.jpg">
<meta property="og:updated_time" content="2016-06-11T13:03:28.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Mysqlä¸»ä»é…ç½®ï¼Œå®ç°è¯»å†™åˆ†ç¦»">
<meta name="twitter:description" content="åŸæ–‡ï¼šhttp://heylinux.com/archives/1004.html
Mysqlä½œä¸ºç›®å‰ä¸–ç•Œä¸Šä½¿ç”¨æœ€å¹¿æ³›çš„å…è´¹æ•°æ®åº“ï¼Œç›¸ä¿¡æ‰€æœ‰ä»äº‹ç³»ç»Ÿè¿ç»´çš„å·¥ç¨‹å¸ˆéƒ½ä¸€å®šæ¥è§¦è¿‡ã€‚ä½†åœ¨å®é™…çš„ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œç”±å•å°Mysqlä½œä¸ºç‹¬ç«‹çš„æ•°æ®åº“æ˜¯å®Œå…¨ä¸èƒ½æ»¡è¶³å®é™…éœ€æ±‚çš„ï¼Œæ— è®ºæ˜¯åœ¨å®‰å…¨æ€§ï¼Œé«˜å¯ç”¨æ€§ä»¥åŠé«˜å¹¶å‘ç­‰å„ä¸ªæ–¹é¢ã€‚
å› æ­¤ï¼Œä¸€èˆ¬æ¥è¯´éƒ½æ˜¯é€šè¿‡ ä¸»ä»å¤åˆ¶ï¼ˆMaster-Slaveï¼‰çš„æ–¹å¼æ¥åŒæ­¥æ•°æ®ï¼Œå†é€šè¿‡è¯»å†™åˆ†ç¦»ï¼ˆMy">
<meta name="twitter:image" content="http://heylinux.com/wp-content/uploads/2011/06/mysql-master-salve-proxy.jpg">


<script type="text/javascript" id="hexo.configuration">
  var CONFIG = {
    scheme: 'Mist',
    sidebar: 'post'
  };
</script>

  <title> Mysqlä¸»ä»é…ç½®ï¼Œå®ç°è¯»å†™åˆ†ç¦» | å´å²–çš„è·¯,èµ°å‡ºè‡ªå·±çš„è„šæ­¥ </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  <!--[if lte IE 8]>
  <div style=' clear: both; height: 59px; padding:0 0 0 15px; position: relative;margin:0 auto;'>
    <a href="http://windows.microsoft.com/en-US/internet-explorer/products/ie/home?ocid=ie6_countdown_bannercode">
      <img src="http://7u2nvr.com1.z0.glb.clouddn.com/picouterie.jpg" border="0" height="42" width="820"
           alt="You are using an outdated browser. For a faster, safer browsing experience, upgrade for free today or use other browser ,like chrome firefox safari."
           style='margin-left:auto;margin-right:auto;display: block;'/>
    </a>
  </div>
<![endif]-->
  

  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "//hm.baidu.com/hm.js?1fd05566bad2ab43a347777c12adcffd";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>



  <div class="container one-column page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><h1 class="site-meta">
  <span class="logo-line-before"><i></i></span>
  <a href="/" class="brand" rel="start">
      <span class="logo">
        <i class="icon-next-logo"></i>
      </span>
      <span class="site-title">å´å²–çš„è·¯,èµ°å‡ºè‡ªå·±çš„è„šæ­¥</span>
  </a>
  <span class="logo-line-after"><i></i></span>
</h1>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu menu-left">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            <i class="menu-item-icon icon-next-home"></i> <br />
            é¦–é¡µ
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            <i class="menu-item-icon icon-next-categories"></i> <br />
            åˆ†ç±»
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            <i class="menu-item-icon icon-next-archives"></i> <br />
            å½’æ¡£
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            <i class="menu-item-icon icon-next-tags"></i> <br />
            æ ‡ç­¾
          </a>
        </li>
      
        
        <li class="menu-item menu-item-guestbook">
          <a href="/guestbook" rel="section">
            <i class="menu-item-icon icon-next-guestbook"></i> <br />
            ç•™è¨€æ¿
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            <i class="menu-item-icon icon-next-about"></i> <br />
            å…³äº
          </a>
        </li>
      

      
      
    </ul>
  

  
    <div class="site-search">
      
  
  <form class="site-search-form">
    <input type="text" id="st-search-input" class="st-search-input st-default-search-input" />
  </form>


<script type="text/javascript">
  (function(w,d,t,u,n,s,e){w['SwiftypeObject']=n;w[n]=w[n]||function(){
    (w[n].q=w[n].q||[]).push(arguments);};s=d.createElement(t);
    e=d.getElementsByTagName(t)[0];s.async=1;s.src=u;e.parentNode.insertBefore(s,e);
  })(window,document,'script','//s.swiftypecdn.com/install/v2/st.js','_st');

  _st('install', '87NaLcEoUCh3qeusbiok','2.0.0');
</script>



    </div>
  
</nav>

 </div>
    </header>

    

    <main id="main" class="main">
      <div class="main-inner">
        <div id="content" class="content"> 

  <div id="posts" class="posts-expand">
    

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <header class="post-header">

      
      
        <h1 class="post-title" itemprop="name headline">
          
          
            
              Mysqlä¸»ä»é…ç½®ï¼Œå®ç°è¯»å†™åˆ†ç¦»
            
          
        </h1>
      

      <div class="post-meta">
        <span class="post-time">
          å‘è¡¨äº
          <time itemprop="dateCreated" datetime="2016-06-11T20:25:04+08:00" content="2016-06-11">
            2016-06-11
          </time>
        </span>

        
          <span class="post-category" >
            &nbsp; | &nbsp; åˆ†ç±»äº
            
              <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                <a href="/categories/æ•°æ®åº“/" itemprop="url" rel="index">
                  <span itemprop="name">æ•°æ®åº“</span>
                </a>
              </span>

              
              

            
          </span>
        

        
          
            <span class="post-comments-count">
              &nbsp; | &nbsp;
             
              <a href="/2016/06/11/Mysqlä¸»ä»é…ç½®ï¼Œå®ç°è¯»å†™åˆ†ç¦»/#comments" itemprop="discussionUrl">
                <span class="post-comments-count ds-thread-count" data-thread-key="2016/06/11/Mysqlä¸»ä»é…ç½®ï¼Œå®ç°è¯»å†™åˆ†ç¦»/" itemprop="commentsCount"></span>
              </a>
             <!--
              <a href="/2016/06/11/Mysqlä¸»ä»é…ç½®ï¼Œå®ç°è¯»å†™åˆ†ç¦»/#comments" itemprop="discussionUrl">
                <span>è¯„è®º</span>
              </a>
			  -->
            </span>
          
        
      </div>
    </header>

    <div class="post-body">

      
      

      
        <span itemprop="articleBody"><p><strong>åŸæ–‡ï¼š<a href="http://heylinux.com/archives/1004.html" target="_blank" rel="external">http://heylinux.com/archives/1004.html</a></strong></p>
<p>Mysqlä½œä¸ºç›®å‰ä¸–ç•Œä¸Šä½¿ç”¨æœ€å¹¿æ³›çš„å…è´¹æ•°æ®åº“ï¼Œç›¸ä¿¡æ‰€æœ‰ä»äº‹ç³»ç»Ÿè¿ç»´çš„å·¥ç¨‹å¸ˆéƒ½ä¸€å®šæ¥è§¦è¿‡ã€‚ä½†åœ¨å®é™…çš„ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œç”±å•å°Mysqlä½œä¸ºç‹¬ç«‹çš„æ•°æ®åº“æ˜¯å®Œå…¨ä¸èƒ½æ»¡è¶³å®é™…éœ€æ±‚çš„ï¼Œæ— è®ºæ˜¯åœ¨å®‰å…¨æ€§ï¼Œé«˜å¯ç”¨æ€§ä»¥åŠé«˜å¹¶å‘ç­‰å„ä¸ªæ–¹é¢ã€‚</p>
<p>å› æ­¤ï¼Œä¸€èˆ¬æ¥è¯´éƒ½æ˜¯é€šè¿‡ ä¸»ä»å¤åˆ¶ï¼ˆMaster-Slaveï¼‰çš„æ–¹å¼æ¥åŒæ­¥æ•°æ®ï¼Œå†é€šè¿‡è¯»å†™åˆ†ç¦»ï¼ˆMySQL-Proxyï¼‰æ¥æå‡æ•°æ®åº“çš„å¹¶å‘è´Ÿè½½èƒ½åŠ› è¿™æ ·çš„æ–¹æ¡ˆæ¥è¿›è¡Œéƒ¨ç½²ä¸å®æ–½çš„ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<br><img src="http://heylinux.com/wp-content/uploads/2011/06/mysql-master-salve-proxy.jpg" alt=""></p>
<p>ä¸‹é¢æ˜¯æˆ‘åœ¨å®é™…å·¥ä½œè¿‡ç¨‹ä¸­æ‰€æ•´ç†çš„ç¬”è®°ï¼Œåœ¨æ­¤åˆ†äº«å‡ºæ¥ï¼Œä»¥ä¾›å¤§å®¶å‚è€ƒã€‚</p>
<h1 id="ä¸€ã€MySQLçš„å®‰è£…ä¸é…ç½®"><a href="#ä¸€ã€MySQLçš„å®‰è£…ä¸é…ç½®" class="headerlink" title="ä¸€ã€MySQLçš„å®‰è£…ä¸é…ç½®"></a>ä¸€ã€MySQLçš„å®‰è£…ä¸é…ç½®</h1><p>å…·ä½“çš„å®‰è£…è¿‡ç¨‹ï¼Œå»ºè®®å‚è€ƒæˆ‘çš„è¿™ä¸€ç¯‡æ–‡ç« ï¼š<a href="http://heylinux.com/archives/993.html" target="_blank" rel="external">http://heylinux.com/archives/993.html</a><br>å€¼å¾—ä¸€æçš„æ˜¯ï¼Œæˆ‘çš„å®‰è£…è¿‡ç¨‹éƒ½æ˜¯æºç åŒ…ç¼–è¯‘å®‰è£…çš„ï¼Œå¹¶ä¸”æ‰€æœ‰çš„é…ç½®ä¸æ•°æ®ç­‰éƒ½ç»Ÿä¸€è§„åˆ’åˆ°äº†/opt/mysqlç›®å½•ä¸­ï¼Œå› æ­¤åœ¨ä¸€å°æœåŠ¡å™¨ä¸Šå®‰è£…å®Œæˆä»¥åï¼Œå¯ä»¥å°†æ•´ä¸ªmysqlç›®å½•æ‰“åŒ…ï¼Œç„¶åä¼ åˆ°å…¶å®ƒæœåŠ¡å™¨ä¸Šè§£åŒ…ï¼Œä¾¿å¯ç«‹å³ä½¿ç”¨ã€‚</p>
<h1 id="äºŒã€MySQLä¸»ä»å¤åˆ¶"><a href="#äºŒã€MySQLä¸»ä»å¤åˆ¶" class="headerlink" title="äºŒã€MySQLä¸»ä»å¤åˆ¶"></a>äºŒã€MySQLä¸»ä»å¤åˆ¶</h1><p>åœºæ™¯æè¿°ï¼š<br>ä¸»æ•°æ®åº“æœåŠ¡å™¨ï¼š192.168.10.130ï¼ŒMySQLå·²ç»å®‰è£…ï¼Œå¹¶ä¸”æ— åº”ç”¨æ•°æ®ã€‚<br>ä»æ•°æ®åº“æœåŠ¡å™¨ï¼š192.168.10.131ï¼ŒMySQLå·²ç»å®‰è£…ï¼Œå¹¶ä¸”æ— åº”ç”¨æ•°æ®ã€‚</p>
<p>ä¸‹é¢æ˜¯æˆ‘åœ¨å®é™…å·¥ä½œè¿‡ç¨‹ä¸­æ‰€æ•´ç†çš„ç¬”è®°ï¼Œåœ¨æ­¤åˆ†äº«å‡ºæ¥ï¼Œä»¥ä¾›å¤§å®¶å‚è€ƒã€‚</p>
<h2 id="2-1-ä¸»æœåŠ¡å™¨ä¸Šè¿›è¡Œçš„æ“ä½œ"><a href="#2-1-ä¸»æœåŠ¡å™¨ä¸Šè¿›è¡Œçš„æ“ä½œ" class="headerlink" title="2.1 ä¸»æœåŠ¡å™¨ä¸Šè¿›è¡Œçš„æ“ä½œ"></a>2.1 ä¸»æœåŠ¡å™¨ä¸Šè¿›è¡Œçš„æ“ä½œ</h2><p>å¯åŠ¨mysqlæœåŠ¡</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">/opt/mysql/init.d/mysql start</div></pre></td></tr></table></figure>
<p>é€šè¿‡å‘½ä»¤è¡Œç™»å½•ç®¡ç†MySQLæœåŠ¡å™¨</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">/opt/mysql/bin/mysql -uroot -p &apos;new-password&apos;</div></pre></td></tr></table></figure>
<p>æˆæƒç»™ä»æ•°æ®åº“æœåŠ¡å™¨192.168.10.131</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mysql&gt; GRANT REPLICATION SLAVE ON *.* to &apos;rep1&apos;@&apos;192.168.10.131&apos; identified by â€˜passwordâ€™;</div></pre></td></tr></table></figure>
<p>æŸ¥è¯¢ä¸»æ•°æ®åº“çŠ¶æ€</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">Mysql&gt; show master status;</div><div class="line">+------------------+----------+--------------+------------------+</div><div class="line">| File | Position | Binlog_Do_DB | Binlog_Ignore_DB |</div><div class="line">+------------------+----------+--------------+------------------+</div><div class="line">| mysql-bin.000005 | 261 | | |</div><div class="line">+------------------+----------+--------------+------------------+</div></pre></td></tr></table></figure>
<p>è®°å½•ä¸‹ FILE åŠ Position çš„å€¼ï¼Œåœ¨åé¢è¿›è¡Œä»æœåŠ¡å™¨æ“ä½œçš„æ—¶å€™éœ€è¦ç”¨åˆ°ã€‚</p>
<p>2.2 é…ç½®ä»æœåŠ¡å™¨<br>ä¿®æ”¹ä»æœåŠ¡å™¨çš„é…ç½®æ–‡ä»¶/opt/mysql/etc/my.cnf<br>å°† server-id = 1ä¿®æ”¹ä¸º server-id = 10ï¼Œå¹¶ç¡®ä¿è¿™ä¸ªIDæ²¡æœ‰è¢«åˆ«çš„MySQLæœåŠ¡æ‰€ä½¿ç”¨ã€‚</p>
<p>å¯åŠ¨mysqlæœåŠ¡</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">/opt/mysql/init.d/mysql start</div></pre></td></tr></table></figure>
<p>é€šè¿‡å‘½ä»¤è¡Œç™»å½•ç®¡ç†MySQLæœåŠ¡å™¨</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">/opt/mysql/bin/mysql -uroot -p&apos;new-password&apos;</div></pre></td></tr></table></figure>
<p>æ‰§è¡ŒåŒæ­¥SQLè¯­å¥</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">mysql&gt; change master to</div><div class="line">master_host=â€™192.168.10.130â€™,</div><div class="line">master_user=â€™rep1â€™,</div><div class="line">master_password=â€™passwordâ€™,</div><div class="line">master_log_file=â€™mysql-bin.000005â€™,</div><div class="line">master_log_pos=261;</div></pre></td></tr></table></figure>
<p>æ­£ç¡®æ‰§è¡Œåå¯åŠ¨SlaveåŒæ­¥è¿›ç¨‹</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mysql&gt; start slave;</div></pre></td></tr></table></figure>
<p>ä¸»ä»åŒæ­¥æ£€æŸ¥</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">mysql&gt; show slave status\G</div><div class="line"></div><div class="line"></div><div class="line">**************** 1. row *******************</div><div class="line">Slave_IO_State:</div><div class="line">Master_Host: 192.168.10.130</div><div class="line">Master_User: rep1</div><div class="line">Master_Port: 3306</div><div class="line">Connect_Retry: 60</div><div class="line">Master_Log_File: mysql-bin.000005</div><div class="line">Read_Master_Log_Pos: 415</div><div class="line">Relay_Log_File: localhost-relay-bin.000008</div><div class="line">Relay_Log_Pos: 561</div><div class="line">Relay_Master_Log_File: mysql-bin.000005</div><div class="line">Slave_IO_Running: YES</div><div class="line">Slave_SQL_Running: YES</div><div class="line">Replicate_Do_DB:</div><div class="line">â€¦â€¦â€¦â€¦â€¦çœç•¥è‹¥å¹²â€¦â€¦â€¦â€¦â€¦</div><div class="line">Master_Server_Id: 1</div><div class="line">1 row in set (0.01 sec)</div></pre></td></tr></table></figure>
<hr>
<p>å…¶ä¸­Slave_IO_Running ä¸ Slave_SQL_Running çš„å€¼éƒ½å¿…é¡»ä¸ºYESï¼Œæ‰è¡¨æ˜çŠ¶æ€æ­£å¸¸ã€‚</p>
<p><strong><em>å¦‚æœä¸»æœåŠ¡å™¨å·²ç»å­˜åœ¨åº”ç”¨æ•°æ®ï¼Œåˆ™åœ¨è¿›è¡Œä¸»ä»å¤åˆ¶æ—¶ï¼Œéœ€è¦åšä»¥ä¸‹å¤„ç†ï¼š</em></strong><br>(1)ä¸»æ•°æ®åº“è¿›è¡Œé”è¡¨æ“ä½œï¼Œä¸è®©æ•°æ®å†è¿›è¡Œå†™å…¥åŠ¨ä½œ</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mysql&gt; FLUSH TABLES WITH READ LOCK;</div></pre></td></tr></table></figure>
<p>(2)æŸ¥çœ‹ä¸»æ•°æ®åº“çŠ¶æ€</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mysql&gt; show master status;</div></pre></td></tr></table></figure>
<p>(3)å¤åˆ¶æ•°æ®æ–‡ä»¶<br>å°†ä¸»æœåŠ¡å™¨çš„æ•°æ®æ–‡ä»¶ï¼ˆæ•´ä¸ª/opt/mysql/dataç›®å½•ï¼‰å¤åˆ¶åˆ°ä»æœåŠ¡å™¨ï¼Œå»ºè®®é€šè¿‡tarå½’æ¡£å‹ç¼©åå†ä¼ åˆ°ä»æœåŠ¡å™¨è§£å‹ã€‚</p>
<p>(4)å–æ¶ˆä¸»æ•°æ®åº“é”å®š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mysql&gt; UNLOCK TABLES;</div></pre></td></tr></table></figure>
<h2 id="2-3-éªŒè¯ä¸»ä»å¤åˆ¶æ•ˆæœ"><a href="#2-3-éªŒè¯ä¸»ä»å¤åˆ¶æ•ˆæœ" class="headerlink" title="2.3 éªŒè¯ä¸»ä»å¤åˆ¶æ•ˆæœ"></a>2.3 éªŒè¯ä¸»ä»å¤åˆ¶æ•ˆæœ</h2><p>ä¸»æœåŠ¡å™¨ä¸Šçš„æ“ä½œ<br>åœ¨ä¸»æœåŠ¡å™¨ä¸Šåˆ›å»ºæ•°æ®åº“first_db</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">mysql&gt; create database first_db;</div><div class="line">Query Ok, 1 row affected (0.01 sec)</div></pre></td></tr></table></figure>
<p>åœ¨ä¸»æœåŠ¡å™¨ä¸Šåˆ›å»ºè¡¨first_tb</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">mysql&gt; create table first_tb(id int(3),name char(10));</div><div class="line">Query Ok, 1 row affected (0.00 sec)</div></pre></td></tr></table></figure>
<p>åœ¨ä¸»æœåŠ¡å™¨ä¸Šçš„è¡¨first_tbä¸­æ’å…¥è®°å½•</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">mysql&gt; insert into first_tb values (001,â€™myselfâ€™);</div><div class="line">Query Ok, 1 row affected (0.00 sec)</div></pre></td></tr></table></figure>
<p>åœ¨ä»æœåŠ¡å™¨ä¸ŠæŸ¥çœ‹</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">mysql&gt; show databases;</div><div class="line"></div><div class="line"></div><div class="line">+--------------------+</div><div class="line">| Database |</div><div class="line">+--------------------+</div><div class="line">| information_schema |</div><div class="line">| first_db |</div><div class="line">| mysql |</div><div class="line">| performance_schema |</div><div class="line">| test |</div><div class="line">+--------------------+</div><div class="line">5 rows in set (0.01 sec)</div></pre></td></tr></table></figure>
<hr>
<p>æ•°æ®åº“first_dbå·²ç»è‡ªåŠ¨ç”Ÿæˆ</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">mysql&gt; use first_db</div><div class="line">Database chaged</div><div class="line"></div><div class="line">mysql&gt; show tables;</div><div class="line"></div><div class="line"></div><div class="line">+--------------------+</div><div class="line">| Tables_in_first_db |</div><div class="line">+--------------------+</div><div class="line">| first_tb |</div><div class="line">+--------------------+</div><div class="line">1 row in set (0.02 sec)</div></pre></td></tr></table></figure>
<hr>
<p>æ•°æ®åº“è¡¨first_tbä¹Ÿå·²ç»è‡ªåŠ¨åˆ›å»º</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">mysql&gt; select * from first_tb;</div><div class="line"></div><div class="line">---</div><div class="line"></div><div class="line">+------+------+</div><div class="line">| id | name |</div><div class="line">+------+------+</div><div class="line">| 1 | myself |</div><div class="line">+------+------+</div><div class="line">1 rows in set (0.00 sec)</div></pre></td></tr></table></figure>
<hr>
<p>è®°å½•ä¹Ÿå·²ç»å­˜åœ¨</p>
<p>ç”±æ­¤ï¼Œæ•´ä¸ªMySQLä¸»ä»å¤åˆ¶çš„è¿‡ç¨‹å°±å®Œæˆäº†ï¼Œæ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬è¿›è¡ŒMySQLè¯»å†™åˆ†ç¦»çš„å®‰è£…ä¸é…ç½®ã€‚</p>
<h1 id="ä¸‰ã€MySQLè¯»å†™åˆ†ç¦»"><a href="#ä¸‰ã€MySQLè¯»å†™åˆ†ç¦»" class="headerlink" title="ä¸‰ã€MySQLè¯»å†™åˆ†ç¦»"></a>ä¸‰ã€MySQLè¯»å†™åˆ†ç¦»</h1><p>åœºæ™¯æè¿°ï¼š<br>æ•°æ®åº“Masterä¸»æœåŠ¡å™¨ï¼š192.168.10.130<br>æ•°æ®åº“Slaveä»æœåŠ¡å™¨ï¼š192.168.10.131<br>MySQL-Proxyè°ƒåº¦æœåŠ¡å™¨ï¼š192.168.10.132</p>
<p>ä»¥ä¸‹æ“ä½œï¼Œå‡æ˜¯åœ¨192.168.10.132å³MySQL-Proxyè°ƒåº¦æœåŠ¡å™¨ ä¸Šè¿›è¡Œçš„ã€‚</p>
<h2 id="3-1-MySQLçš„å®‰è£…ä¸é…ç½®"><a href="#3-1-MySQLçš„å®‰è£…ä¸é…ç½®" class="headerlink" title="3.1 MySQLçš„å®‰è£…ä¸é…ç½®"></a>3.1 MySQLçš„å®‰è£…ä¸é…ç½®</h2><p>å…·ä½“çš„å®‰è£…è¿‡ç¨‹ä¸ä¸Šæ–‡ç›¸åŒã€‚</p>
<h2 id="3-2-æ£€æŸ¥ç³»ç»Ÿæ‰€éœ€è½¯ä»¶åŒ…"><a href="#3-2-æ£€æŸ¥ç³»ç»Ÿæ‰€éœ€è½¯ä»¶åŒ…" class="headerlink" title="3.2 æ£€æŸ¥ç³»ç»Ÿæ‰€éœ€è½¯ä»¶åŒ…"></a>3.2 æ£€æŸ¥ç³»ç»Ÿæ‰€éœ€è½¯ä»¶åŒ…</h2><p>é€šè¿‡ rpm -qa | grep name çš„æ–¹å¼éªŒè¯ä»¥ä¸‹è½¯ä»¶åŒ…æ˜¯å¦å·²å…¨éƒ¨å®‰è£…ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">gcc* gcc-c++* autoconf* automake* zlib* libxml* ncurses-devel* libmcrypt* libtool* flex* pkgconfig* libevent* glib*</div></pre></td></tr></table></figure>
<p>è‹¥ç¼ºå°‘ç›¸å…³çš„è½¯ä»¶åŒ…ï¼Œå¯é€šè¿‡yum -y installæ–¹å¼åœ¨çº¿å®‰è£…ï¼Œæˆ–ç›´æ¥ä»ç³»ç»Ÿå®‰è£…å…‰ç›˜ä¸­æ‰¾åˆ°å¹¶é€šè¿‡rpm -ivhæ–¹å¼å®‰è£…ã€‚</p>
<h2 id="3-3-ç¼–è¯‘å®‰è£…lua"><a href="#3-3-ç¼–è¯‘å®‰è£…lua" class="headerlink" title="3.3 ç¼–è¯‘å®‰è£…lua"></a>3.3 ç¼–è¯‘å®‰è£…lua</h2><p>MySQL-Proxyçš„è¯»å†™åˆ†ç¦»ä¸»è¦æ˜¯é€šè¿‡rw-splitting.luaè„šæœ¬å®ç°çš„ï¼Œå› æ­¤éœ€è¦å®‰è£…luaã€‚</p>
<p>luaå¯é€šè¿‡ä»¥ä¸‹æ–¹å¼è·å¾—<br>ä»<a href="http://www.lua.org/download.htmlä¸‹è½½æºç åŒ…" target="_blank" rel="external">http://www.lua.org/download.htmlä¸‹è½½æºç åŒ…</a></p>
<p>ä»rpm.pbone.netæœç´¢ç›¸å…³çš„rpmåŒ…</p>
<p>download.fedora.redhat.com/pub/fedora/epel/5/i386/lua-5.1.4-4.el5.i386.rpm<br>download.fedora.redhat.com/pub/fedora/epel/5/x86_64/lua-5.1.4-4.el5.x86_64.rpm</p>
<p>è¿™é‡Œæˆ‘ä»¬å»ºè®®é‡‡ç”¨æºç åŒ…è¿›è¡Œå®‰è£…</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">cd /opt/install</div><div class="line">wget http://www.lua.org/ftp/lua-5.1.4.tar.gz</div><div class="line">tar zvfx lua-5.1.4.tar.gz</div><div class="line">cd lua-5.1.4</div><div class="line"></div><div class="line">vi src/Makefile</div><div class="line">åœ¨ CFLAGS= -O2 -Wall $(MYCFLAGS) è¿™ä¸€è¡Œè®°å½•é‡ŒåŠ ä¸Š-fPICï¼Œæ›´æ”¹ä¸º CFLAGS= -O2 -Wall -fPIC $(MYCFLAGS) æ¥é¿å…ç¼–è¯‘è¿‡ç¨‹ä¸­å‡ºç°é”™è¯¯ã€‚</div><div class="line"></div><div class="line">make linux</div><div class="line">make install</div><div class="line"></div><div class="line">cp etc/lua.pc /usr/lib/pkgconfig/</div><div class="line">export PKG_CONFIG_PATH=$PKG_CONFIG_PATH:/usr/lib/pkgconfig</div></pre></td></tr></table></figure>
<h2 id="3-4-å®‰è£…é…ç½®MySQL-Proxy"><a href="#3-4-å®‰è£…é…ç½®MySQL-Proxy" class="headerlink" title="3.4 å®‰è£…é…ç½®MySQL-Proxy"></a>3.4 å®‰è£…é…ç½®MySQL-Proxy</h2><p>MySQL-Proxyå¯é€šè¿‡ä»¥ä¸‹ç½‘å€è·å¾—ï¼š<br><a href="http://mysql.cdpa.nsysu.edu.tw/Downloads/MySQL-Proxy/" target="_blank" rel="external">http://mysql.cdpa.nsysu.edu.tw/Downloads/MySQL-Proxy/</a></p>
<p>æ¨èé‡‡ç”¨å·²ç»ç¼–è¯‘å¥½çš„äºŒè¿›åˆ¶ç‰ˆæœ¬ï¼Œå› ä¸ºé‡‡ç”¨æºç åŒ…è¿›è¡Œç¼–è¯‘æ—¶ï¼Œæœ€æ–°ç‰ˆçš„MySQL-Proxyå¯¹automakeï¼Œglibä»¥åŠlibeventçš„ç‰ˆæœ¬éƒ½æœ‰å¾ˆé«˜çš„è¦æ±‚ï¼Œè€Œè¿™äº›è½¯ä»¶åŒ…éƒ½æ˜¯ç³»ç»Ÿçš„åŸºç¡€å¥—ä»¶ï¼Œä¸å»ºè®®å¼ºè¡Œè¿›è¡Œæ›´æ–°ã€‚<br>å¹¶ä¸”è¿™äº›å·²ç»ç¼–è¯‘å¥½çš„äºŒè¿›åˆ¶ç‰ˆæœ¬åœ¨è§£å‹åéƒ½åœ¨ç»Ÿä¸€çš„ç›®å½•å†…ï¼Œå› æ­¤å»ºè®®é€‰æ‹©ä»¥ä¸‹ç‰ˆæœ¬ï¼š</p>
<p>32ä½RHEL5å¹³å°ï¼š<br><a href="http://mysql.cdpa.nsysu.edu.tw/Downloads/MySQL-Proxy/mysql-proxy-0.8.1-linux-rhel5-x86-32bit.tar.gz" target="_blank" rel="external">http://mysql.cdpa.nsysu.edu.tw/Downloads/MySQL-Proxy/mysql-proxy-0.8.1-linux-rhel5-x86-32bit.tar.gz</a></p>
<p>64ä½RHEL5å¹³å°ï¼š<br><a href="http://mysql.cdpa.nsysu.edu.tw/Downloads/MySQL-Proxy/mysql-proxy-0.8.1-linux-rhel5-x86-64bit.tar.gz" target="_blank" rel="external">http://mysql.cdpa.nsysu.edu.tw/Downloads/MySQL-Proxy/mysql-proxy-0.8.1-linux-rhel5-x86-64bit.tar.gz</a></p>
<p>æµ‹è¯•å¹³å°ä¸ºRHEL5 32ä½ï¼Œå› æ­¤é€‰æ‹©32ä½çš„è½¯ä»¶åŒ…<br>wget <a href="http://mysql.cdpa.nsysu.edu.tw/Downloads/MySQL-Proxy/mysql-proxy-0.8.1-linux-rhel5-x86-32bit.tar.gz" target="_blank" rel="external">http://mysql.cdpa.nsysu.edu.tw/Downloads/MySQL-Proxy/mysql-proxy-0.8.1-linux-rhel5-x86-32bit.tar.gz</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">tar xzvf mysql-proxy-0.8.1-linux-rhel5-x86-32bit.tar.gz</div><div class="line">mv mysql-proxy-0.8.1-linux-rhel5-x86-32bit /opt/mysql-proxy</div></pre></td></tr></table></figure>
<p>åˆ›å»ºmysql-proxyæœåŠ¡ç®¡ç†è„šæœ¬</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mkdir /opt/mysql-proxy/init.d/</div></pre></td></tr></table></figure>
<p>vim mysql-proxy</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div></pre></td><td class="code"><pre><div class="line">#!/bin/sh</div><div class="line">#</div><div class="line"># mysql-proxy This script starts and stops the mysql-proxy daemon</div><div class="line">#</div><div class="line"># chkconfig: - 78 30</div><div class="line"># processname: mysql-proxy</div><div class="line"># description: mysql-proxy is a proxy daemon to mysql</div><div class="line"></div><div class="line"># Source function library.</div><div class="line">. /etc/rc.d/init.d/functions</div><div class="line"></div><div class="line">#PROXY_PATH=/usr/local/bin</div><div class="line">PROXY_PATH=/opt/mysql-proxy/bin</div><div class="line"></div><div class="line">prog=&quot;mysql-proxy&quot;</div><div class="line"></div><div class="line"></div><div class="line"># Source networking configuration.</div><div class="line">. /etc/sysconfig/network</div><div class="line"></div><div class="line"># Check that networking is up.</div><div class="line">[ $&#123;NETWORKING&#125; = &quot;no&quot; ] &amp;&amp; exit 0</div><div class="line"></div><div class="line"># Set default mysql-proxy configuration.</div><div class="line">#PROXY_OPTIONS=&quot;--daemon&quot;</div><div class="line">PROXY_OPTIONS=&quot;--admin-username=root --admin-password=password --proxy-read-only-backend-addresses=192.168.10.131:3306 --proxy-backend-addresses=192.168.10.130:3306  --admin-lua-script=/opt/mysql-proxy/lib/mysql-proxy/lua/admin.lua --proxy-lua-script=/opt/mysql-proxy/scripts/rw-splitting.lua&quot;</div><div class="line">PROXY_PID=/opt/mysql-proxy/run/mysql-proxy.pid</div><div class="line"></div><div class="line"># Source mysql-proxy configuration.</div><div class="line">if [ -f /etc/sysconfig/mysql-proxy ]; then</div><div class="line">        . /etc/sysconfig/mysql-proxy</div><div class="line">fi</div><div class="line"></div><div class="line">PATH=$PATH:/usr/bin:/usr/local/bin:$PROXY_PATH</div><div class="line"></div><div class="line"># By default it&apos;s all good</div><div class="line">RETVAL=0</div><div class="line"></div><div class="line"># See how we were called.</div><div class="line">case &quot;$1&quot; in</div><div class="line">  start)</div><div class="line">        # Start daemon.</div><div class="line">        echo -n $&quot;Starting $prog: &quot;</div><div class="line">        $NICELEVEL $PROXY_PATH/mysql-proxy $PROXY_OPTIONS --daemon --pid-file=$PROXY_PID --user=mysql --log-level=warning --log-file=/opt/mysql-proxy/log/mysql-proxy.log</div><div class="line">        RETVAL=$?</div><div class="line">        echo</div><div class="line">        if [ $RETVAL = 0 ]; then</div><div class="line">                touch /var/lock/subsys/mysql-proxy</div><div class="line">        fi</div><div class="line">       ;;</div><div class="line">  stop)</div><div class="line">        # Stop daemons.</div><div class="line">        echo -n $&quot;Stopping $prog: &quot;</div><div class="line">        killproc $prog</div><div class="line">        RETVAL=$?</div><div class="line">        echo</div><div class="line">        if [ $RETVAL = 0 ]; then</div><div class="line">                rm -f /var/lock/subsys/mysql-proxy</div><div class="line">                rm -f $PROXY_PID</div><div class="line">        fi</div><div class="line">       ;;</div><div class="line">  restart)</div><div class="line">        $0 stop</div><div class="line">        sleep 3</div><div class="line">        $0 start</div><div class="line">       ;;</div><div class="line">  condrestart)</div><div class="line">       [ -e /var/lock/subsys/mysql-proxy ] &amp;&amp; $0 restart</div><div class="line">      ;;</div><div class="line">  status)</div><div class="line">        status mysql-proxy</div><div class="line">        RETVAL=$?</div><div class="line">       ;;</div><div class="line">  *)</div><div class="line">        echo &quot;Usage: $0 &#123;start|stop|restart|status|condrestart&#125;&quot;</div><div class="line">        RETVAL=1</div><div class="line">       ;;</div><div class="line">esac</div><div class="line"></div><div class="line">exit $RETVAL</div></pre></td></tr></table></figure>
<p>è„šæœ¬å‚æ•°è¯¦è§£ï¼š</p>
<hr>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">PROXY_PATH=/opt/mysql-proxy/bin //å®šä¹‰mysql-proxyæœåŠ¡äºŒè¿›åˆ¶æ–‡ä»¶è·¯å¾„</div><div class="line"></div><div class="line">PROXY_OPTIONS=&quot;--admin-username=root \ //å®šä¹‰å†…éƒ¨ç®¡ç†æœåŠ¡å™¨è´¦å·</div><div class="line">--admin-password=password \ //å®šä¹‰å†…éƒ¨ç®¡ç†æœåŠ¡å™¨å¯†ç </div><div class="line">--proxy-read-only-backend-addresses=192.168.10.131:3306 \ //å®šä¹‰åç«¯åªè¯»ä»æœåŠ¡å™¨åœ°å€</div><div class="line">--proxy-backend-addresses=192.168.10.130:3306 \ //å®šä¹‰åç«¯ä¸»æœåŠ¡å™¨åœ°å€</div><div class="line">--admin-lua-script=/opt/mysql-proxy/lib/mysql-proxy/lua/admin.lua \ //å®šä¹‰luaç®¡ç†è„šæœ¬è·¯å¾„</div><div class="line">--proxy-lua-script=/opt/mysql-proxy/scripts/rw-splitting.lua&quot; \ //å®šä¹‰luaè¯»å†™åˆ†ç¦»è„šæœ¬è·¯å¾„</div><div class="line"></div><div class="line">PROXY_PID=/opt/mysql-proxy/run/mysql-proxy.pid //å®šä¹‰mysql-proxy PIDæ–‡ä»¶è·¯å¾„</div><div class="line"></div><div class="line">\$NICELEVEL \$PROXY_PATH/mysql-proxy \$PROXY_OPTIONS \</div><div class="line">--daemon \ //å®šä¹‰ä»¥å®ˆæŠ¤è¿›ç¨‹æ¨¡å¼å¯åŠ¨</div><div class="line">--keepalive \ //ä½¿è¿›ç¨‹åœ¨å¼‚å¸¸å…³é—­åèƒ½å¤Ÿè‡ªåŠ¨æ¢å¤</div><div class="line">--pid-file=$PROXY_PID \ //å®šä¹‰mysql-proxy PIDæ–‡ä»¶è·¯å¾„</div><div class="line">--user=mysql \ //ä»¥mysqlç”¨æˆ·èº«ä»½å¯åŠ¨æœåŠ¡</div><div class="line">--log-level=warning \ //å®šä¹‰logæ—¥å¿—çº§åˆ«ï¼Œç”±é«˜åˆ°ä½åˆ†åˆ«æœ‰(error|warning|info|message|debug)</div><div class="line">--log-file=/opt/mysql-proxy/log/mysql-proxy.log //å®šä¹‰logæ—¥å¿—æ–‡ä»¶è·¯å¾„</div></pre></td></tr></table></figure>
<hr>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">cp mysql-proxy /opt/mysql-proxy/init.d/</div><div class="line">chmod +x /opt/mysql-proxy/init.d/mysql-proxy</div><div class="line"></div><div class="line">mkdir /opt/mysql-proxy/run</div><div class="line">mkdir /opt/mysql-proxy/log</div><div class="line"></div><div class="line">mkdir /opt/mysql-proxy/scripts</div></pre></td></tr></table></figure>
<p>é…ç½®å¹¶ä½¿ç”¨rw-splitting.luaè¯»å†™åˆ†ç¦»è„šæœ¬<br>æœ€æ–°çš„è„šæœ¬æˆ‘ä»¬å¯ä»¥ä»æœ€æ–°çš„mysql-proxyæºç åŒ…ä¸­è·å–</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">cd /opt/install</div><div class="line"></div><div class="line">wget http://mysql.cdpa.nsysu.edu.tw/Downloads/MySQL-Proxy/mysql-proxy-0.8.1.tar.gz</div><div class="line"></div><div class="line">tar xzvf mysql-proxy-0.8.1.tar.gz</div><div class="line">cd mysql-proxy-0.8.1</div><div class="line">cp lib/rw-splitting.lua /opt/mysql-proxy/scripts</div></pre></td></tr></table></figure>
<p>ä¿®æ”¹è¯»å†™åˆ†ç¦»è„šæœ¬rw-splitting.lua<br>ä¿®æ”¹é»˜è®¤è¿æ¥ï¼Œè¿›è¡Œå¿«é€Ÿæµ‹è¯•ï¼Œä¸ä¿®æ”¹çš„è¯è¦è¾¾åˆ°è¿æ¥æ•°ä¸º4æ—¶æ‰å¯ç”¨è¯»å†™åˆ†ç¦»<br>vim /opt/mysql-proxy/scripts/rw-splitting.lua</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">-- connection pool</div><div class="line">if not proxy.global.config.rwsplit then</div><div class="line">proxy.global.config.rwsplit = &#123;</div><div class="line">min_idle_connections = 1, //é»˜è®¤ä¸º4</div><div class="line">max_idle_connections = 1, //é»˜è®¤ä¸º8</div><div class="line">is_debug = false</div><div class="line">&#125;</div><div class="line">end</div></pre></td></tr></table></figure>
<p>ä¿®æ”¹å®Œæˆåï¼Œå¯åŠ¨mysql-proxy</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">/opt/mysql-proxy/init.d/mysql-proxy start</div></pre></td></tr></table></figure>
<p>3.5 æµ‹è¯•è¯»å†™åˆ†ç¦»æ•ˆæœ<br>åˆ›å»ºç”¨äºè¯»å†™åˆ†ç¦»çš„æ•°æ®åº“è¿æ¥ç”¨æˆ·<br>ç™»é™†ä¸»æ•°æ®åº“æœåŠ¡å™¨192.168.10.130ï¼Œé€šè¿‡å‘½ä»¤è¡Œç™»å½•ç®¡ç†MySQLæœåŠ¡å™¨</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">/opt/mysql/bin/mysql -uroot -p&apos;new-password&apos;</div><div class="line">mysql&gt; GRANT ALL ON *.* TO &apos;proxy1&apos;@&apos;192.168.10.132&apos; IDENTIFIED BY &apos;password&apos;;</div></pre></td></tr></table></figure>
<p>ç”±äºæˆ‘ä»¬é…ç½®äº†ä¸»ä»å¤åˆ¶åŠŸèƒ½ï¼Œå› æ­¤ä»æ•°æ®åº“æœåŠ¡å™¨192.168.10.131ä¸Šå·²ç»åŒæ­¥äº†æ­¤æ“ä½œã€‚</p>
<p>ä¸ºäº†æ¸…æ™°çš„çœ‹åˆ°è¯»å†™åˆ†ç¦»çš„æ•ˆæœï¼Œéœ€è¦æš‚æ—¶å…³é—­MySQLä¸»ä»å¤åˆ¶åŠŸèƒ½<br>ç™»é™†ä»æ•°æ®åº“æœåŠ¡å™¨192.168.10.131ï¼Œé€šè¿‡å‘½ä»¤è¡Œç™»å½•ç®¡ç†MySQLæœåŠ¡å™¨</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">/opt/mysql/bin/mysql -uroot -p&apos;new-password&apos;</div></pre></td></tr></table></figure>
<p>å…³é—­SlaveåŒæ­¥è¿›ç¨‹</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">mysql&gt; stop slave;</div><div class="line">Query OK, 0 rows affected (0.00 sec)</div></pre></td></tr></table></figure>
<p>è¿æ¥MySQL-Proxy</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">/opt/mysql/bin/mysql -uproxy1 -p&apos;password&apos; -P4040 -h192.168.10.132</div></pre></td></tr></table></figure>
<p>ç™»é™†æˆåŠŸåï¼Œåœ¨first_dbæ•°æ®çš„first_tbè¡¨ä¸­æ’å…¥ä¸¤æ¡è®°å½•</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">mysql&gt; use first_db;</div><div class="line">Database changed</div><div class="line">mysql&gt; insert into first_tb values (007,â€™firstâ€™);</div><div class="line">Query Ok, 1 row affected (0.00 sec)</div><div class="line">mysql&gt; insert into first_tb values (110,â€™secondâ€™);</div><div class="line">Query Ok, 1 row affected (0.00 sec)</div></pre></td></tr></table></figure>
<p>æŸ¥è¯¢è®°å½•</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">mysql&gt; select * from first_tb;</div><div class="line"></div><div class="line">---</div><div class="line"></div><div class="line">+------+------+</div><div class="line">| id | name |</div><div class="line">+------+------+</div><div class="line">| 1 | myself |</div><div class="line">+------+------+</div><div class="line">1 rows in set (0.00 sec)</div></pre></td></tr></table></figure>
<p>é€šè¿‡è¯»æ“ä½œå¹¶æ²¡æœ‰çœ‹åˆ°æ–°è®°å½•</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mysql&gt; quit</div></pre></td></tr></table></figure>
<p>é€€å‡ºMySQL-Proxy</p>
<p>ä¸‹é¢ï¼Œåˆ†åˆ«ç™»é™†åˆ°ä¸»ä»æ•°æ®åº“æœåŠ¡å™¨ï¼Œå¯¹æ¯”è®°å½•ä¿¡æ¯<br>é¦–å…ˆï¼Œæ£€æŸ¥ä¸»æ•°æ®åº“æœåŠ¡å™¨</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">mysql&gt; select * from first_tb;</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">+------+------+</div><div class="line">| id | name |</div><div class="line">+------+------+</div><div class="line">| 1 | myself |</div><div class="line">+------+------+</div><div class="line">| 007 | first |</div><div class="line">+------+------+</div><div class="line">| 110 | second |</div><div class="line">+------+------+</div><div class="line">3 rows in set (0.00 sec)</div></pre></td></tr></table></figure>
<hr>
<p>ä¸¤æ¡æ–°è®°å½•éƒ½å·²ç»å­˜åœ¨</p>
<p>ç„¶åï¼Œæ£€æŸ¥ä»æ•°æ®åº“æœåŠ¡å™¨</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">mysql&gt; select * from first_tb;</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">+------+------+</div><div class="line">| id | name |</div><div class="line">+------+------+</div><div class="line">| 1 | myself |</div><div class="line">+------+------+</div><div class="line">1 rows in set (0.00 sec)</div></pre></td></tr></table></figure>
<hr>
<p>æ²¡æœ‰æ–°è®°å½•å­˜åœ¨</p>
<p>ç”±æ­¤éªŒè¯ï¼Œæˆ‘ä»¬å·²ç»å®ç°äº†MySQLè¯»å†™åˆ†ç¦»ï¼Œç›®å‰æ‰€æœ‰çš„å†™æ“ä½œéƒ½å…¨éƒ¨åœ¨Masterä¸»æœåŠ¡å™¨ä¸Šï¼Œç”¨æ¥é¿å…æ•°æ®çš„ä¸åŒæ­¥ï¼›<br>å¦å¤–ï¼Œæ‰€æœ‰çš„è¯»æ“ä½œéƒ½åˆ†æ‘Šç»™äº†å…¶å®ƒå„ä¸ªSlaveä»æœåŠ¡å™¨ä¸Šï¼Œç”¨æ¥åˆ†æ‹…æ•°æ®åº“å‹åŠ›ã€‚</p>
<p><strong><em>ç»éªŒåˆ†äº«ï¼š</em></strong></p>
<ul>
<li><p>1.å½“MySQLä¸»ä»å¤åˆ¶åœ¨ show slave status\G æ—¶å‡ºç°Slave_IO_Runningæˆ–Slave_SQL_Running çš„å€¼ä¸ä¸ºYESæ—¶ï¼Œéœ€è¦é¦–å…ˆé€šè¿‡ stop slave æ¥åœæ­¢ä»æœåŠ¡å™¨ï¼Œç„¶åå†æ‰§è¡Œä¸€æ¬¡æœ¬æ–‡ 2.1ä¸2.2 ç« èŠ‚ä¸­çš„æ­¥éª¤å³å¯æ¢å¤ï¼Œä½†å¦‚æœæƒ³å°½å¯èƒ½çš„åŒæ­¥æ›´å¤šçš„æ•°æ®ï¼Œå¯ä»¥åœ¨Slaveä¸Šå°†master_log_posèŠ‚ç‚¹çš„å€¼åœ¨ä¹‹å‰åŒæ­¥å¤±æ•ˆçš„å€¼çš„åŸºç¡€ä¸Šå¢å¤§ä¸€äº›ï¼Œç„¶ååå¤æµ‹è¯•ï¼Œç›´åˆ°åŒæ­¥OKã€‚å› ä¸ºMySQLä¸»ä»å¤åˆ¶çš„åŸç†å…¶å®å°±æ˜¯ä»æœåŠ¡å™¨è¯»å–ä¸»æœåŠ¡å™¨çš„binlogï¼Œç„¶åæ ¹æ®binlogçš„è®°å½•æ¥æ›´æ–°æ•°æ®åº“ã€‚</p>
</li>
<li><p>2.MySQL-Proxyçš„rw-splitting.luaè„šæœ¬åœ¨ç½‘ä¸Šæœ‰å¾ˆå¤šç‰ˆæœ¬ï¼Œä½†æ˜¯æœ€å‡†ç¡®æ— è¯¯çš„ç‰ˆæœ¬ä»ç„¶æ˜¯æºç åŒ…ä¸­æ‰€é™„å¸¦çš„lib/rw-splitting.luaè„šæœ¬ï¼Œå¦‚æœæœ‰luaè„šæœ¬ç¼–ç¨‹åŸºç¡€çš„è¯ï¼Œå¯ä»¥åœ¨è¿™ä¸ªè„šæœ¬çš„åŸºç¡€ä¸Šå†è¿›è¡Œä¼˜åŒ–ï¼›</p>
</li>
<li><p>3.MySQL-Proxyå®é™…ä¸Šéå¸¸ä¸ç¨³å®šï¼Œåœ¨é«˜å¹¶å‘æˆ–æœ‰é”™è¯¯è¿æ¥çš„æƒ…å†µä¸‹ï¼Œè¿›ç¨‹å¾ˆå®¹æ˜“è‡ªåŠ¨å…³é—­ï¼Œå› æ­¤æ‰“å¼€â€“keepaliveå‚æ•°è®©è¿›ç¨‹è‡ªåŠ¨æ¢å¤æ˜¯ä¸ªæ¯”è¾ƒå¥½çš„åŠæ³•ï¼Œä½†è¿˜æ˜¯ä¸èƒ½ä»æ ¹æœ¬ä¸Šè§£å†³é—®é¢˜ï¼Œå› æ­¤é€šå¸¸æœ€ç¨³å¦¥çš„åšæ³•æ˜¯åœ¨æ¯ä¸ªä»æœåŠ¡å™¨ä¸Šå®‰è£…ä¸€ä¸ªMySQL-Proxyä¾›è‡ªèº«ä½¿ç”¨ï¼Œè™½ç„¶æ¯”è¾ƒä½æ•ˆä½†å´èƒ½ä¿è¯ç¨³å®šæ€§ï¼›</p>
</li>
<li><p>4.ä¸€ä¸»å¤šä»çš„æ¶æ„å¹¶ä¸æ˜¯æœ€å¥½çš„æ¶æ„ï¼Œé€šå¸¸æ¯”è¾ƒä¼˜çš„åšæ³•æ˜¯é€šè¿‡ç¨‹åºä»£ç å’Œä¸­é—´ä»¶ç­‰æ–¹é¢ï¼Œæ¥è§„åˆ’ï¼Œæ¯”å¦‚è®¾ç½®å¯¹è¡¨æ•°æ®çš„è‡ªå¢idå€¼å·®å¼‚å¢é•¿ç­‰æ–¹å¼æ¥å®ç°ä¸¤ä¸ªæˆ–å¤šä¸ªä¸»æœåŠ¡å™¨ï¼Œä½†ä¸€å®šè¦æ³¨æ„ä¿è¯å¥½è¿™äº›ä¸»æœåŠ¡å™¨æ•°æ®çš„å®Œæ•´æ€§ï¼Œå¦åˆ™æ•ˆæœä¼šæ¯”å¤šä¸ªä¸€ä¸»å¤šä»çš„æ¶æ„è¿˜è¦å·®ï¼›</p>
</li>
<li><p>5.MySQL-Cluster çš„ç¨³å®šæ€§ä¹Ÿä¸æ˜¯å¤ªå¥½ï¼›</p>
</li>
<li><p>6.Amoeba for MySQL æ˜¯ä¸€æ¬¾ä¼˜ç§€çš„ä¸­é—´ä»¶è½¯ä»¶ï¼ŒåŒæ ·å¯ä»¥å®ç°è¯»å†™åˆ†ç¦»ï¼Œè´Ÿè½½å‡è¡¡ç­‰åŠŸèƒ½ï¼Œå¹¶ä¸”ç¨³å®šæ€§è¦å¤§å¤§è¶…è¿‡MySQL-Proxyï¼Œå»ºè®®å¤§å®¶ç”¨æ¥æ›¿ä»£MySQL-Proxyï¼Œç”šè‡³MySQL-Clusterã€‚</p>
</li>
</ul>
</span>
      
    </div>

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/mysql/" rel="tag">#mysql</a>
          
        </div>
      

      
        <div class="post-nav">
          <div class="post-nav-prev post-nav-item">
            
              <a href="/2016/06/12/30å¤šæ¡mysqlæ•°æ®åº“ä¼˜åŒ–æ–¹æ³•,åƒä¸‡çº§æ•°æ®åº“è®°å½•æŸ¥è¯¢è½»æ¾è§£å†³/" rel="prev">30å¤šæ¡mysqlæ•°æ®åº“ä¼˜åŒ–æ–¹æ³•,åƒä¸‡çº§æ•°æ®åº“è®°å½•æŸ¥è¯¢è½»æ¾è§£å†³</a>
            
          </div>

          <div class="post-nav-next post-nav-item">
            
              <a href="/2016/06/09/javaçº¿ç¨‹å¸¸è§é¢è¯•é¢˜/" rel="next">javaçº¿ç¨‹å¸¸è§é¢è¯•é¢˜</a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
        <div class="ds-share flat" data-thread-key="2016/06/11/Mysqlä¸»ä»é…ç½®ï¼Œå®ç°è¯»å†™åˆ†ç¦»/"
     data-title="Mysqlä¸»ä»é…ç½®ï¼Œå®ç°è¯»å†™åˆ†ç¦»"
     data-content=""
     data-url="http://dingran.tk/2016/06/11/Mysqlä¸»ä»é…ç½®ï¼Œå®ç°è¯»å†™åˆ†ç¦»/">
  <div class="ds-share-inline">
    <ul  class="ds-share-icons-16">

      <li data-toggle="ds-share-icons-more"><a class="ds-more" href="javascript:void(0);">åˆ†äº«åˆ°ï¼š</a></li>
      <li><a class="ds-weibo" href="javascript:void(0);" data-service="weibo">å¾®åš</a></li>
      <li><a class="ds-qzone" href="javascript:void(0);" data-service="qzone">QQç©ºé—´</a></li>
      <li><a class="ds-qqt" href="javascript:void(0);" data-service="qqt">è…¾è®¯å¾®åš</a></li>
      <li><a class="ds-wechat" href="javascript:void(0);" data-service="wechat">å¾®ä¿¡</a></li>

    </ul>
    <div class="ds-share-icons-more">
    </div>
  </div>
</div>
      
    </div>
  </div>

 </div>

        

        
          <div class="comments" id="comments">
            
              <div class="ds-thread" data-thread-key="2016/06/11/Mysqlä¸»ä»é…ç½®ï¼Œå®ç°è¯»å†™åˆ†ç¦»/"
                   data-title="Mysqlä¸»ä»é…ç½®ï¼Œå®ç°è¯»å†™åˆ†ç¦»" data-url="http://dingran.tk/2016/06/11/Mysqlä¸»ä»é…ç½®ï¼Œå®ç°è¯»å†™åˆ†ç¦»/">
              </div>
            
          </div>
        
      </div>

      
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            æ–‡ç« ç›®å½•
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            ç«™ç‚¹æ¦‚è§ˆ
          </li>
        </ul>
      

      <section class="site-overview">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" src="/images/default_avatar.png" alt="ğŸ’‹D.RğŸ’˜" itemprop="image"/>
          <p class="site-author-name" itemprop="name">ğŸ’‹D.RğŸ’˜</p>
        </div>
        <p class="site-description motion-element" itemprop="description">ä¹¦ä¸è®°ï¼Œç†Ÿè¯»å¯è®°ï¼›ä¹‰ä¸ç²¾ï¼Œç»†æ€å¯ç²¾ï¼›æƒŸæœ‰å¿—ä¸ç«‹ï¼Œç›´æ˜¯æ— ç€åŠ›å¤„ã€‚â€”â€”æœ±ç†¹</p>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">79</span>
              <span class="site-state-item-name">æ—¥å¿—</span>
            </a>
          </div>

          <div class="site-state-item site-state-categories">
            <a href="/categories">
              <span class="site-state-item-count">25</span>
              <span class="site-state-item-name">åˆ†ç±»</span>
              </a>
          </div>

          <div class="site-state-item site-state-tags">
            <a href="/tags">
              <span class="site-state-item-count">65</span>
              <span class="site-state-item-name">æ ‡ç­¾</span>
              </a>
          </div>

        </nav>

        
          <div class="feed-link motion-element">
            <a href="/atom.xml" rel="alternate">
              <i class="menu-item-icon icon-next-feed"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
            
                <a href="https://github.com/MrDingran" target="_blank"><img style="width:28px;height:28px;margin: 0 8px 15px 8px;" src="/images/github.png"></img></a>
            
                <a href="https://www.zhihu.com/people/gavin-97-57" target="_blank"><img style="width:28px;height:28px;margin: 0 8px 15px 8px;" src="/images/zhihu.png"></img></a>
            
                <a href="https://www.facebook.com/ran.ding.509" target="_blank"><img style="width:28px;height:28px;margin: 0 8px 15px 8px;" src="/images/facebook.png"></img></a>
            
                <a href="https://twitter.com/MrDingran" target="_blank"><img style="width:28px;height:28px;margin: 0 8px 15px 8px;" src="/images/twitter.png"></img></a>
            
          
        </div>

        <div class="links-of-friendly motion-element">
          
        </div>

        
        

      </section>

      
        <section class="post-toc-wrap sidebar-panel-active">
          <div class="post-toc-indicator-top post-toc-indicator"></div>
          <div class="post-toc">
            
            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#ä¸€ã€MySQLçš„å®‰è£…ä¸é…ç½®"><span class="nav-number">1.</span> <span class="nav-text">ä¸€ã€MySQLçš„å®‰è£…ä¸é…ç½®</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#äºŒã€MySQLä¸»ä»å¤åˆ¶"><span class="nav-number">2.</span> <span class="nav-text">äºŒã€MySQLä¸»ä»å¤åˆ¶</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#2-1-ä¸»æœåŠ¡å™¨ä¸Šè¿›è¡Œçš„æ“ä½œ"><span class="nav-number">2.1.</span> <span class="nav-text">2.1 ä¸»æœåŠ¡å™¨ä¸Šè¿›è¡Œçš„æ“ä½œ</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-3-éªŒè¯ä¸»ä»å¤åˆ¶æ•ˆæœ"><span class="nav-number">2.2.</span> <span class="nav-text">2.3 éªŒè¯ä¸»ä»å¤åˆ¶æ•ˆæœ</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#ä¸‰ã€MySQLè¯»å†™åˆ†ç¦»"><span class="nav-number">3.</span> <span class="nav-text">ä¸‰ã€MySQLè¯»å†™åˆ†ç¦»</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#3-1-MySQLçš„å®‰è£…ä¸é…ç½®"><span class="nav-number">3.1.</span> <span class="nav-text">3.1 MySQLçš„å®‰è£…ä¸é…ç½®</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-2-æ£€æŸ¥ç³»ç»Ÿæ‰€éœ€è½¯ä»¶åŒ…"><span class="nav-number">3.2.</span> <span class="nav-text">3.2 æ£€æŸ¥ç³»ç»Ÿæ‰€éœ€è½¯ä»¶åŒ…</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-3-ç¼–è¯‘å®‰è£…lua"><span class="nav-number">3.3.</span> <span class="nav-text">3.3 ç¼–è¯‘å®‰è£…lua</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-4-å®‰è£…é…ç½®MySQL-Proxy"><span class="nav-number">3.4.</span> <span class="nav-text">3.4 å®‰è£…é…ç½®MySQL-Proxy</span></a></li></ol></li></ol></div>
            
          </div>
          <div class="post-toc-indicator-bottom post-toc-indicator"></div>
        </section>
      

    </div>
	<iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width=330 height=86 src="http://music.163.com/outchain/player?type=2&id=406086764&auto=0&height=66"></iframe>
  </aside>


    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner"> <div class="copyright" >
  
  &copy; &nbsp; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="icon-next-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">ğŸ’‹D.RğŸ’˜</span>
	<span class="with-love">
    <i class="icon-next-heart"></i>
  </span>
  <div class="powered-by"></div>
  <div class="powered-by">
    Powered by <a class="theme-link" href="http://hexo.io">Hexo</a>
  </div>
	<a class="theme-link" href="https://github.com/gavincloud">GitHub</a> å¼ºåŠ›é©±åŠ¨
  <!-- busuanzi -->
  

</div>

<!--
<div class="theme-info">
  ä¸»é¢˜ -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Mist
  </a>
</div>
-->

<!--
<div class="powered-by"></div>
<div class="powered-by">
  ç”± <a class="theme-link" href="http://hexo.io">Hexo</a> å¼ºåŠ›é©±åŠ¨
</div>
-->

<!-- busuanzi -->
<!--

-->


 </div>
    </footer>

    <div class="back-to-top"></div>
  </div>

  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  
  
    

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"dingran"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>
    

    
  
  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js"></script>
  <script type="text/javascript" src="/js/fancy-box.js?v=0.4.5.1"></script>


  <script type="text/javascript" src="/js/helpers.js?v=0.4.5.1"></script>
  

  <script type="text/javascript" src="/vendors/velocity/velocity.min.js"></script>
  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js"></script>

  <script type="text/javascript" src="/js/motion_global.js?v=0.4.5.1" id="motion.global"></script>




  <script type="text/javascript" src="/js/nav-toggle.js?v=0.4.5.1"></script>
  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  
<script type="text/javascript" src="/js/bootstrap.scrollspy.js?v=0.4.5.1" id="bootstrap.scrollspy.custom"></script>


<script type="text/javascript" id="sidebar.toc.highlight">
  $(document).ready(function () {
    var tocSelector = '.post-toc';
    var $tocSelector = $(tocSelector);
    var activeCurrentSelector = '.active-current';

    $tocSelector
      .on('activate.bs.scrollspy', function () {
        var $currentActiveElement = $(tocSelector + ' .active').last();

        removeCurrentActiveClass();
        $currentActiveElement.addClass('active-current');

        $tocSelector[0].scrollTop = $currentActiveElement.position().top;
      })
      .on('clear.bs.scrollspy', function () {
        removeCurrentActiveClass();
      });

    function removeCurrentActiveClass () {
      $(tocSelector + ' ' + activeCurrentSelector)
        .removeClass(activeCurrentSelector.substring(1));
    }

    function processTOC () {
      getTOCMaxHeight();
      toggleTOCOverflowIndicators();
    }

    function getTOCMaxHeight () {
      var height = $('.sidebar').height() -
                   $tocSelector.position().top -
                   $('.post-toc-indicator-bottom').height();

      $tocSelector.css('height', height);

      return height;
    }

    function toggleTOCOverflowIndicators () {
      tocOverflowIndicator(
        '.post-toc-indicator-top',
        $tocSelector.scrollTop() > 0 ? 'show' : 'hide'
      );

      tocOverflowIndicator(
        '.post-toc-indicator-bottom',
        $tocSelector.scrollTop() >= $tocSelector.find('ol').height() - $tocSelector.height() ? 'hide' : 'show'
      )
    }

    $(document).on('sidebar.motion.complete', function () {
      processTOC();
    });

    $('body').scrollspy({ target: tocSelector });
    $(window).on('resize', function () {
      if ( $('.sidebar').hasClass('sidebar-active') ) {
        processTOC();
      }
    });

    onScroll($tocSelector);

    function onScroll (element) {
      element.on('mousewheel DOMMouseScroll', function (event) {
          var oe = event.originalEvent;
          var delta = oe.wheelDelta || -oe.detail;

          this.scrollTop += ( delta < 0 ? 1 : -1 ) * 30;
          event.preventDefault();

          toggleTOCOverflowIndicators();
      });
    }

    function tocOverflowIndicator (indicator, action) {
      var $indicator = $(indicator);
      var opacity = action === 'show' ? 0.4 : 0;
      $indicator.velocity ?
        $indicator.velocity('stop').velocity({
          opacity: opacity
        }, { duration: 100 }) :
        $indicator.stop().animate({
          opacity: opacity
        }, 100);
    }

  });
</script>

<script type="text/javascript" id="sidebar.nav">
  $(document).ready(function () {
    var html = $('html');
    var TAB_ANIMATE_DURATION = 200;
    var hasVelocity = $.isFunction(html.velocity);

    $('.sidebar-nav li').on('click', function () {
      var item = $(this);
      var activeTabClassName = 'sidebar-nav-active';
      var activePanelClassName = 'sidebar-panel-active';
      if (item.hasClass(activeTabClassName)) {
        return;
      }

      var currentTarget = $('.' + activePanelClassName);
      var target = $('.' + item.data('target'));

      hasVelocity ?
        currentTarget.velocity('transition.slideUpOut', TAB_ANIMATE_DURATION, function () {
          target
            .velocity('stop')
            .velocity('transition.slideDownIn', TAB_ANIMATE_DURATION)
            .addClass(activePanelClassName);
        }) :
        currentTarget.animate({ opacity: 0 }, TAB_ANIMATE_DURATION, function () {
          currentTarget.hide();
          target
            .stop()
            .css({'opacity': 0, 'display': 'block'})
            .animate({ opacity: 1 }, TAB_ANIMATE_DURATION, function () {
              currentTarget.removeClass(activePanelClassName);
              target.addClass(activePanelClassName);
            });
        });

      item.siblings().removeClass(activeTabClassName);
      item.addClass(activeTabClassName);
    });

    $('.post-toc a').on('click', function (e) {
      e.preventDefault();
      var targetSelector = escapeSelector(this.getAttribute('href'));
      var offset = $(targetSelector).offset().top;
      hasVelocity ?
        html.velocity('stop').velocity('scroll', {
          offset: offset  + 'px',
          mobileHA: false
        }) :
        $('html, body').stop().animate({
          scrollTop: offset
        }, 500);
    });

    // Expand sidebar on post detail page by default, when post has a toc.
    var $tocContent = $('.post-toc-content');
    if (isDesktop() && CONFIG.sidebar === 'post') {
      if ($tocContent.length > 0 && $tocContent.html().trim().length > 0) {
        displaySidebar();
      }
    }
  });
</script>



  <script type="text/javascript">
    $(document).ready(function () {
      if (CONFIG.sidebar === 'always') {
        displaySidebar();
      }
      if (isMobile()) {
        FastClick.attach(document.body);
      }
    });
  </script>

  

  
  

  
  <script type="text/javascript" src="/js/lazyload.js"></script>
  <script type="text/javascript">
    $(function () {
      $("#posts").find('img').lazyload({
        placeholder: "/images/loading.gif",
        effect: "fadeIn"
      });
    });
  </script>
</body>
</html>
